import numpy as np
import pytest
import os

from obara_saika import OverlapIntegralPWGTO, NucAttIntegralPWGTO

class TestPWGTO:
   #def __overlap__(self, l_a, l_b, S_ref):

   #    A = np.array([0.0, 1.2, 0.7])
   #    B = np.array([0.3, 0.0, -0.25])

   #    alpha = 0.8
   #    beta = 1.1

   #    S = OverlapIntegralGTO(A, alpha, l_a, B, beta, l_b)

   #    assert np.allclose(S.integral().flatten(), S_ref.flatten())

   #def test_overlap_ss(self):
   #    S_ref = np.array([0.68913535])
   #    self.__overlap__(0, 0, S_ref)

   #def test_overlap_ps(self):
   #    S_ref = np.array([0.11969193,  -0.47876772, -0.37902444])
   #    self.__overlap__(1, 0, S_ref)


   #def test_overlap_pp(self):
   #    S_ref = np.array([[ 0.16623243,  0.06047592,  0.04787677],
   #             [ 0.06047592, -0.06055228, -0.19150709],
   #             [ 0.04787677, -0.19150709,  0.02974163]])
   #    self.__overlap__(1, 1, S_ref)


   #def test_overlap_sd(self):
   #    S_ref = np.array([0.19234703, -0.07617991, -0.06030909,  0.35728136,  0.24123637,  0.29161306])
   #    self.__overlap__(0, 2, S_ref)


   #def test_overlap_dp(self):
   #    S_ref = np.array([[ 0.03746228,  0.1021339,   0.080856  ],
   #             [-0.20003072, -0.01821594, -0.05761105],
   #             [-0.15835766, -0.05761105,  0.00894717],
   #             [-0.0649224 ,  0.00770658,  0.20558759],
   #             [-0.05761105,  0.05768379, -0.03578868],
   #             [-0.04923977,  0.19695908, -0.04356061]])
   #    self.__overlap__(2, 1, S_ref)


   #def test_overlap_dd(self):
   #    S_ref = np.array([[ 0.13595341,  0.03278479,  0.02595463,  0.10479923,  0.07076044,  0.08553714],
   #             [ 0.01493013, -0.04381905, -0.13858535, -0.01954075, -0.01262037, -0.06094643],
   #             [ 0.01181968, -0.13858535,  0.02152272, -0.0591145,   0.00783004, -0.00460452],
   #             [ 0.14345572, -0.00168609, -0.04497956,  0.10727923,  0.00533928,  0.21749003],
   #             [ 0.12730021, -0.01262037,  0.00783004,  0.06187905, -0.00783993,  0.01841808],
   #             [ 0.10880262, -0.04309177,  0.00953042,  0.20209902, -0.03812169,  0.1008121 ]])
   #    self.__overlap__(2, 2, S_ref)


    def __nuclear_attraction__(self, l_a, l_b, V_ref):


        k_a = np.array([0.25, 0.50, 0.75])
        k_b = np.array([-0.30, 0.00, -0.60])
        A = np.array([0.0, 1.2, 0.7])
        B = np.array([0.3, 0.0, -0.25])
        C = np.array([1.0, 0.0, 0.0])

        Z = 1.0
        alpha = 0.8
        beta = 1.1

        V = NucAttIntegralPWGTO(A, alpha, l_a, k_a, B, beta, l_b, k_b, C, Z)

        assert np.allclose(V.integral().flatten(), V_ref.flatten())


    def test_nuclear_attraction_ss(self):
        V_ref = np.array([[-0.4515895247979211935 +0.25526760149233762576j]])
        self.__nuclear_attraction__(0, 0, V_ref)

    def test_nuclear_attraction_ps(self):
        V_ref = np.array([[-0.18948799273008667954  +0.039897264164505827355j],
                          [0.33785095510809315389   -0.25210799421808444132j],
                          [0.19261728793700824691   -0.2739097524766610503j],])
        self.__nuclear_attraction__(1, 0, V_ref)


    def test_nuclear_attraction_ds(self):
        V_ref = np.array([[-0.17881743736552185853   +0.061782879948273757009j],
                         [0.27888367584135398403   -0.099278525564375857959j],
                         [0.18765227244153456776   -0.12309803492225876442j],
                         [-0.34760320176838943595   +0.29029807744514724011j],
                         [-0.2269116925035623844   +0.40810884754121490303j],
                         [-0.12792065343664332788   +0.26094900244612878604j],])
        self.__nuclear_attraction__(2, 0, V_ref)


    def test_nuclear_attraction_sd(self):
        V_ref = np.array([[-0.10576769895928275766      +0.060818605583880643028j],
                          [-0.0089288666460968606209      -0.044523586643220078307j],
                          [-0.0013071352684594363894      -0.041130358107303595372j],
                          [-0.18704982521797230977        +0.05282423747071079978j],
                          [-0.16232855017679995169        -0.071996985209108382842j],
                          [-0.16950735248645154574        -0.029100516912692518667j],])
        self.__nuclear_attraction__(0, 2, V_ref)


    def test_nuclear_attraction_pp(self):
        V_ref = np.array([[-0.12197103954649585189      +0.049813700698922006027j],
                          [-0.066372025956505958932   -0.009441766461934529564j],
                          [-0.071672503085417393898   -0.033168282642799529203j],
                          [0.059658278787170095081        +0.018313914806083811393j],
                          [0.057817944361322357039        -0.012231515616554049231j],
                          [0.18995088060348319647     -0.0038808415205918295188j],
                          [0.050555903627062498407        +0.011102242143918247125j],
                          [0.10013321877520453551     -0.093069949985404881732j],
                          [0.055065770103514530276        +0.00073473759330078963758j],])
        self.__nuclear_attraction__(1, 1, V_ref)


    def test_nuclear_attraction_pd(self):
        V_ref = np.array([[-0.059048638771829184413    -0.01479352628716103929j],
                          [-0.083036578876726316323    +0.011403134891633460307j],
                          [-0.096822720711566861995    -0.021969482229985216881j],
                          [-0.058520755424316998894    -0.0082285538793484026832j],
                          [-0.035927510852997932012    -0.038797819881835310385j],
                          [-0.047686636753288907942    -0.026692172459724539807j],
                          [0.08052657265258048036      -0.058687012281241360268j],
                          [0.0065476585304091016598    +0.011727751628908244727j],
                          [0.014339616522193373085     +0.032157705409661507812j],
                          [0.043932742398077762047     -0.037600315461770950076j],
                          [0.043483148994597736747     +0.02043751188291801843j],
                          [0.13505604928027728495      +0.0020771792910318637171j],
                          [0.044805092614557243125     -0.063337774786590056442j],
                          [0.02125347751383406536      +0.025098682991956274696j],
                          [0.0067247048351649057335    +0.0079627134830950324629j],
                          [0.090337823164232777806     -0.088264397159590640696j],
                          [0.035821645775301440284     +0.011510627433989032917j],
                          [0.0051942389034534131032    -0.051192924377875551056j],])
        self.__nuclear_attraction__(1, 2, V_ref)

    def test_nuclear_attraction_dp(self):
        V_ref = np.array([[-0.095639950635777931653    +0.00015058392251556191113j],
                          [-0.067852798954015317023    +0.0037510730607098318606j],
                          [-0.077402374792120295921    -0.022634571272278525278j],
                          [0.17047546617910203093      -0.092132697736641191999j],
                          [0.03659074369730936499      +0.0053720696784751087102j],
                          [0.11304098936649807638      +0.030141161002725132267j],
                          [0.10387431495763056744      -0.10393534972736931388j],
                          [0.073284224247053289525     -0.023261881617828373409j],
                          [0.035337718308323246008     +0.0083444943356433976672j],
                          [-0.067809642129510669384    -0.015205677207361316394j],
                          [-0.025448790835509063624    -0.02292249672190608753j],
                          [-0.20283604894693618714     +0.016456612811879073321j],
                          [-0.083824994931719451485    +0.0020231060265176580709j],
                          [-0.051653287367253067353    +0.040563838059289585025j],
                          [-0.078630408117331906936    +0.0099835040237955842424j],
                          [-0.044145598298906130186    -0.0059498552637775696528j],
                          [-0.074444921005258610225    +0.095062116333689702929j],
                          [-0.047118242694885369148    -0.051890925091511302947j],])
        self.__nuclear_attraction__(2, 1, V_ref)


    def test_nuclear_attraction_dd(self):
        V_ref = np.array([[-0.092643279216340593263        +0.028553004826418704187j],
                          [-0.051283409494897756742        -0.022692137203605574486j],
                          [-0.051165905708698666832        -0.040190433210639676942j],
                          [-0.060924390056485630551        +0.0045807756604335546705j],
                          [-0.045462184138144887124        -0.031676571380076290474j],
                          [-0.053049616142860182844        -0.018813910188952301383j],
                          [0.096357855132827727185     +0.0046346893118668101505j],
                          [0.042483797913857111739     -0.0025529453247304652146j],
                          [0.14116791542512582835      +0.010957218863578286477j],
                          [0.034748476410281489701     -0.011348457176485721165j],
                          [0.019436830301713000496     +0.019604606821437164932j],
                          [0.074397626283918619206     +0.0261678290952815501j],
                          [0.075042390851831550225     -0.0092576063467988342626j],
                          [0.076558064331874606245     -0.053468761010377952037j],
                          [0.0430859026688904731       +0.0037308711132953949544j],
                          [0.064401721790907126564     -0.021698999110231893123j],
                          [0.016305436851959596162     +0.013071994157130910688j],
                          [0.018980978418001913377     -0.024019234547844024036j],
                          [-0.083604708936338867353        +0.067542126794597701078j],
                          [0.0040631635889987281068        -0.0058840621030541283981j],
                          [-0.019030625318124310547        -0.033401775030755691265j],
                          [-0.049864217414531203376        +0.040113872186763238625j],
                          [-0.0048037786094437635517       -0.027826487271876677865j],
                          [-0.14406249696457310017     +0.006592216936309053428j],
                          [-0.055300860418996365675        +0.09324528430231041054j],
                          [-0.013931510080822578912        -0.010312444462841687323j],
                          [-0.016285072824599199082        -0.0094592924882698561917j],
                          [-0.024913054667767300238        +0.058567900910009594584j],
                          [-0.017534985649865341556        -0.0063743722567894192665j],
                          [0.00025700692167053063898       +0.067217768456887094786j],
                          [-0.029367623471573515298        +0.060035327319808907964j],
                          [-0.021523349014999478002        -0.019749817727090435843j],
                          [0.0098935031183656017145        -0.0049831885536307709422j],
                          [-0.066847963025220072386        +0.089701183166414039105j],
                          [-0.02297753373994724721     -0.050119822818016648847j],
                          [-0.0031564789222924688472       +0.023297462940626578048j],])
        self.__nuclear_attraction__(2, 2, V_ref)


